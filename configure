#!/bin/sh

ARCH_LIST="i386 x86_64"
TARGET_ARCH=i386

usage()
{
  echo "Configure options:"
  echo " --help: print usage"
  echo " --arch=ARCH"
  echo "supported arch: i386 or x86_64"
}

check_i386_tools() 
{
  echo "check not implemented, I'm so lazy..."
}
check_x86_64_tools()
{
  echo "I'm always lazy to check your tools..."
}

#if [ $# == 0 ]; then
#  echo "configure: error, empty parameters"
#  echo ""
#  usage
#  exit 1
#fi

for i
do
  case $i in
    "--help")
      usage
      exit 0
      ;;
    "--arch="*)
      TARGET_ARCH="${i##--arch=}"
      if [ $TARGET_ARCH != "i386" ] &&\
        [ $TARGET_ARCH != "x86_64" ]
    then
      echo "Arch not supported -> $TARGET_ARCH"
      echo ""
      usage
      exit 1
    fi
    ;;
  *)
    echo "Unknown option -> $i"
    echo ""
    usage 
    exit 1
    ;;
esac
done

if [ $TARGET_ARCH == "i386" ]; then
  check_i386_tools 
elif [ $TARGET_ARCH == "x86_64" ]; then
  check_x86_64_tools
fi

cat <<EOF > ./var.mk
TARGET_ARCH=$TARGET_ARCH
TARGET_REPO=$TARGET_ARCH
EOF

if [ $TARGET_ARCH == "i386" ]; then
  echo CFLAGS=-m32 >> var.mk 
  echo LDFLAGS=-m32 >> var.mk 
elif [ $TARGET_ARCH == "x86_64" ]; then
  echo CFLAGS= >> var.mk 
  echo LDFLAGS= >> var.mk 
fi

cat <<EOF > ./config.hh
 /*
  * This file was generated by the devil.
  * Please do not edit it directly or you will go to hell
  */

#ifndef _CONFIG_H_
#define _CONFIG_H_

# define TARGET_ARCH $TARGET_ARCH
# define TARGET_REPO $TARGET_ARCH
# define $TARGET_ARCH

#endif /* _CONFIG_H_ */

EOF

echo "done!"
